{% extends "structure/base.html" %}
{% load crispy_forms_tags %}
{% block sidebar %}
<div class="col-md-4">
  <div class="content-section4">
    <h3>Edit</h3>
    <p class='text-muted'>Add and delete any Alloy Grade or Material strength.
      <div class="list-group">
        <a href = "alloyEdit" class="list-group-item list-group-item-light">Edit Alloy Grade</a>
        <a href = "#" class="list-group-item list-group-item-light">Edit Material Strength</a>
      </div>
    </p>
  </div>
</div>
{% endblock %}

{% block content %}

    <h1 style = "text-align:center" class = "display-3">Structural Calculation</h1>
    <h4> Material Specifications </h4>
    
      <div class = "dropdown">
        <label for="alloygrade">Alluminium Alloy Grade:</label>      
        <select name = "alloygrade" class = "form-control">
          {% for result in objects %}
            <option>{{ result.alloygrade }}</option> 
          {% endfor %}
        </select> 
      </div>

    
    {% for result in mats %}
      <div class = "dropdown">
        <label for="matStr">Material Strength of Alloy according to:</label>
        <select name = "matStr" class = "form-control">
          <option>{{ result.name}}</option>
        </select>
      </div>
      <p>Permissible Bending Stress : {{ result.bendStress }} kg/cm<sup>2</sup></p>
    {% endfor %}

    <p>Elastic Modulus of Alluminium (E) : 700000 kg/cm <sup>2</sup></p>
    <p>
      Maximum Allowable Deflection (f<sub>m</sub>): l/ 
      <select>
        <option> 75 </option>
        <option> 100 </option>
        <option> 125 </option>
        <option> 150 </option>
        <option> 175 </option>
        <option> 200 </option>
        <option> 225 </option>
        <option> 250 </option>
        <option> 275 </option>
        <option> 300 </option>
      </select>
      or
      <input type="number" max = "23">
      mm   (whichever is less)
    </p>
    <p>
      Design Wind Load : 
      P = <input id = "windLoad" type = "number" oninput="lengthConverter(this.value)"> Pa
        or <span id = "output"></span> kg/cm
    </p>
    <p>
      Type of Loading : 
      <select name = "shapeChoice" id = "shapeChoice">
        <option> Rectangular </option>
        <option> Trapezoidal </option>
      </select>
    </p>
    <p>
      Load Increase Coefficient
      <label>&gamma;<sub>s</sub> = </label>
      <input type = "float">
    </p>
    <p>
      Material Decrease Coefficient
      <label>&gamma;<sub>m</sub> = </label>
      <input type = "float">
    </p>
    <p>
      Unsupported Length
      <label> l = </label>
      <input type = "float" name = "length" id = "length"> m
    </p>
    <p>
      Left Panel Width
      <label> a = </label>
      <input type = "float" name = "lwidth" id = "lwidth"> m
    </p>
    <p>
      Right Panel Width
      <label> b = </label>
      <input type = "float" name = "rwidth" id = "rwidth"> m
    </p>
    <p>
      <button class = "btn btn-secondary" onclick="draw()">Show Diagram</button>
      <a class = "btn btn-secondary" href = "structSpecs"> Continue &#8594; </a>
    </p>

    <p></p>
    <div class = "content-section2">
      <div class = "row">
        <canvas id = "myCanvas1" height = "100" width = "100" style="border:1px solid #0c0202;"></canvas>
        <canvas id = "myCanvas2" height = "100" width = "100" style="border:1px solid #0c0202;"></canvas>
        <canvas id = "myCanvas5" height = "100" width = "100" style="border:none;"></canvas>
      </div>
      <div class = "row">
        <canvas id = "myCanvas3" class = "labelCanvas" height = "100" width = "100" style="border:none;"></canvas>
        <canvas id = "myCanvas4" class = "labelCanvas2" height = "100" width = "100" style="border:none;"></canvas>
      </div>
      
    </div>
    
  

    <script>
      function lengthConverter(valNum) {
        document.getElementById("output").innerHTML=valNum/100000;
      }

      function draw() {
        var shape = document.getElementById("shapeChoice");
        var canvas1 = document.getElementById("myCanvas1");
        var lwidth = document.getElementById('lwidth').value;
        var length = document.getElementById('length').value;
        var canvas2 = document.getElementById("myCanvas2");
        var rwidth = document.getElementById('rwidth').value;
        var ctx = canvas1.getContext("2d");
        var ctx2 = canvas2.getContext("2d");
        var canvas3 = document.getElementById("myCanvas3");
        var ctx3 = canvas3.getContext("2d");
        var canvas4 = document.getElementById("myCanvas4");
        var ctx4 = canvas4.getContext("2d");
        var canvas5 = document.getElementById("myCanvas5");
        var ctx5 = canvas5.getContext("2d");

        if (shape.value == "Rectangular") {
          
          ctx.canvas.width  = lwidth * 100;
          ctx.canvas.height = length * 100;
          ctx.fillStyle = "#808080";
          ctx.fillRect((lwidth * 100)/2,0,(lwidth * 100 /2),(length * 100));
          ctx3.canvas.width = lwidth * 100;
          drawHLabel(ctx3,lwidth,"a");
          ctx5.canvas.height = length * 100;
          drawVLabel(ctx5,length);

          ctx2.canvas.width  = rwidth * 100;
          ctx2.canvas.height = length * 100;
          ctx2.fillStyle = "#808080";
          ctx2.fillRect(0,0,(rwidth * 100/2),(length * 100));
          ctx4.canvas.width = rwidth * 100;
          drawHLabel(ctx4,rwidth,"b");        
          
        } else if (shape.value == "Trapezoidal") {
            ctx.canvas.width  = lwidth * 100;
            ctx.canvas.height = length * 100;
            ctx.fillStyle = "#808080";
            ctx.beginPath();
            ctx.moveTo(lwidth*100,length*100);
            ctx.lineTo(lwidth*100*0.5,length*100*0.75);
            ctx.lineTo(lwidth*100*0.5,length*100*0.25);
            ctx.lineTo(lwidth*100,length-length);
            ctx.closePath();
            ctx.stroke();
            ctx.fill();
            ctx3.canvas.width = lwidth * 100;
            drawHLabel(ctx3,lwidth,"a");
            ctx5.canvas.height = length * 100;
            drawVLabel(ctx5,length);

            ctx2.canvas.width  = rwidth * 100;
            ctx2.canvas.height = length * 100;
            ctx2.fillStyle = "#808080";
            ctx2.beginPath();
            ctx2.moveTo(rwidth-rwidth,length-length);
            ctx2.lineTo(rwidth*100*0.5,length*100*0.25);
            ctx2.lineTo(rwidth*100*0.5,length*100*0.75);
            ctx2.lineTo(rwidth-rwidth,length*100);
            ctx2.closePath();
            ctx2.stroke();
            ctx2.fill();
            ctx4.canvas.width = rwidth * 100;
            drawHLabel(ctx4,rwidth,"b");
        }

      }
      function drawHLabel(context,width,panel){
        context.beginPath();
        context.moveTo(0,5);
        context.lineTo(0,15);
        context.moveTo(0,10);
        context.lineTo(width*100,10);
        context.moveTo(width*100,5);
        context.lineTo(width*100,15);
        context.closePath();
        context.stroke();
        context.font="12px Arial";
        context.fillStyle = "red";
        context.textAlign = "center";
        context.fillText(panel + " = " + width + "m", (width/2) * 100, 25);
      }
      function drawVLabel(context,height){
        context.beginPath();
        context.moveTo(5,0);
        context.lineTo(15,0);
        context.moveTo(10,0);
        context.lineTo(10,height*100);
        context.moveTo(15,height*100);
        context.lineTo(5,height*100);
        context.stroke();
        context.font="12px Arial";
        context.fillStyle = "red";
        context.textAlign = "center";
        context.fillText("l = " + height + "m", 40, (height * 100)/2);
      }  
    </script>

    
    <!-- <a href = "" data-toggle = "modal" data-target = "#addMatStr">Add Alloy</a>
    <form method = "POST">
        {% csrf_token %}
        <div class="modal" tabindex="-1" id = "addMatStr">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Add a new Alluminium Alloy Grade</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <p>{{form|crispy}}</p>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  <button type="submit" class="btn btn-primary">Add</button>
                </div>
              </div>
            </div>
          </div>
    </form> -->


    <!-- <div class = "content-section">
        <form method = "POST">
            {% csrf_token %}
            <fieldset class = "form-group">
                <legend class = "border-bottom mb-4"> Create Project</legend>
                {{ form|crispy }}
            </fieldset>
            <div class = "form-group">
                <button class = "btn btn-outline-info" type="submit"> Save </button>
            </div>
        </form>
    </div>
    -->


    
{% endblock content %}